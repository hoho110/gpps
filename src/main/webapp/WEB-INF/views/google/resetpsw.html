<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>政采贷</title>

<!-- Bootstrap core CSS -->
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/index/justified-nav.css" rel="stylesheet">
<link href="css/plist/a.css" rel="stylesheet">
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script type="text/javascript"
				src="/resources/EasyServiceClientFullZ.js"></script>
		<script type="text/javascript"
				src="/easyservice/gpps.service.ILenderService?json"></script>
<!--[if lt IE 9]>
      <script src="js/cdn/html5shiv.min.js"></script>
      <script src="js/cdn/respond.min.js"></script>
<![endif]-->
</head>
<body>
	<div class="container">
	
	<div class="row" id="header" style="padding-left:15px; padding-right:15px;">
      
      </div>
	
	<div class="form-horizontal" role="form" style="width:400px; margin: 0 auto; margin-top:50px;">
		<div style="width:100%" id="message"></div>
		<div class="form-group has-success has-feedback">
			<label class="control-label col-sm-3" for="loginId">用户名</label>
			<div class="col-sm-9" id="loginIdContent">
				<input type="text" class="form-control" id="loginId">
			</div>
		</div>
		
		<div class="form-group has-success has-feedback">
			<label class="control-label col-sm-3" for="password">新密码</label>
			<div class="col-sm-9">
				<input type="password" class="form-control" id="password">
			</div>
		</div>
		
		
		<div class="form-group has-success has-feedback">
			<label class="control-label col-sm-3" for="password_r">确认密码</label>
			<div class="col-sm-9">
				<input type="password" class="form-control" id="password_r">
			</div>
			</div>
			
			
			<div class="form-group has-success has-feedback">
			<label class="control-label col-sm-3" for="validate">验证码</label>
			<div class="col-sm-6">
				<input type="text" class="form-control" id="validate">
			</div>
			<button type="submit" class="btn btn-default" id="sendValCode">发送验证码</button>
			<a href="/messageValidateCode" target="_blank">察看验证码</a>
			</div>
		
		

			
			
			<button id="confirm" class="btn btn-lg btn-success btn-block">确认修改</button>
			

		</div>
		
	</div>
	
</body>
<script src="js/head.js"></script>
 <script>
 
 var ok = '<span class="glyphicon glyphicon-ok form-control-feedback"></span>';
 var error = '<span class="glyphicon glyphicon-remove form-control-feedback"></span>';
 
 function addMessage(title){
		$('#message').html('');
		var div = $('<div class="alert alert-warning alert-dismissible" role="alert" style="margin-bottom:2px;"></div>');
		div.append('<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>');
		div.append(title);
		$('#message').append(div);
}

function removeMessage(){
	  $('#message').html('');
}
 
$(document).ready(function() {
	
	header('resetpsw');
	
	$('#loginId').focus();
	
		if(cuser){
			$('#loginIdContent').html('<label class="control-label">'+cuser.loginId+'</label>');
		}
	
       $('#confirm').click(function(e){
    	   var loginId = cuser==null?$('#loginId').val():cuser.loginId;
			var validate = $('input#validate').val();
			var password = $('input#password').val();
			var password_r = $('input#password_r').val();

			
			if(loginId==null||loginId==''){
				$('input#loginId').parent().find('span').remove();
				$('input#loginId').parent().append(error);
				$('input#loginId').parent().parent().removeClass('has-success').addClass('has-error');
				addMessage('*请输入登陆名');
				return;
			}else{
				$('input#loginId').parent().find('span').remove();
				$('input#loginId').parent().append(ok);
				$('input#loginId').parent().parent().removeClass('has-error').addClass('has-success');
				removeMessage();
			}
			
			if(password==null||password==''){
				$('input#password').parent().find('span').remove();
				$('input#password').parent().append(error);
				$('input#password').parent().parent().removeClass('has-success').addClass('has-error');
				addMessage('*请输入密码');
				return;
				}else if(password_r!=password){
					$('input#password_r').parent().find('span').remove();
					$('input#password_r').parent().append(error);
					$('input#password_r').parent().parent().removeClass('has-success').addClass('has-error');
					addMessage('*输入密码不一致');
				return;
				}
			else{
				$('input#password').parent().find('span').remove();
				$('input#password').parent().append(ok);
				$('input#password').parent().parent().removeClass('has-error').addClass('has-success');
				$('input#password_r').parent().find('span').remove();
				$('input#password_r').parent().append(ok);
				$('input#password_r').parent().parent().removeClass('has-error').addClass('has-success');
				removeMessage();
				}


			if(validate==null||validate==''){
				$('input#validate').parent().find('span').remove();
				$('input#validate').parent().append(error);
				$('input#validate').parent().parent().removeClass('has-success').addClass('has-error');
				addMessage('*验证码错误');
				return;
				}
				else{
					$('input#validate').parent().find('span').remove();
					$('input#validate').parent().append(ok);
					$('input#validate').parent().parent().removeClass('has-error').addClass('has-success');
					removeMessage();
				}


			try{
				service.changePassword(loginId, password, validate);
				if(cuser)
					window.location.href="myaccount.html";
				else
					window.location.href="login.html";
			}catch(e){
				alert(e.message);
				$('input#password').val('');
				$('input#password_r').val('');
				$('input#validate').val('');
			}
           });
       
       
       $('button#sendValCode').click(function(e){
     		  service.sendMessageValidateCode();
     		 	var t = 300;
  	    		$('button#sendValCode').attr('disabled', true);
  				setInterval(count,1000);  
  				//显示当前的秒数
  		    	function count(){
  		    	t --;
  		    	//秒数自减 
  		    	if(t >= 0){
  		    		$('button#sendValCode').html(t+'秒后重发');
  		    		//刷新当前的秒数，重新显示秒数
  		    		}else{
  		    			$('button#sendValCode').html('发送验证码');
  		    			$('button#sendValCode').attr('disabled', false);
  		    			clearInterval();
  		    			}
  		    	}
        });
	
})
</script>
</html>