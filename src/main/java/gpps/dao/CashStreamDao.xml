<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="gpps.dao.ICashStreamDao">
	<select id="findSubmitCashStream" parameterType="Integer" resultType="gpps.model.CashStream">
		select *
		from CashStream where submitId=#{submitId}
	</select>
	<select id="find" parameterType="Integer" resultType="gpps.model.CashStream">
		select *
		from CashStream where id=#{id}
	</select>
	<select id="findByState" parameterType="Integer" resultType="gpps.model.CashStream">
		select *
		from CashStream where state=#{state}
	</select>
	<select id="findByActionAndState" resultType="gpps.model.CashStream">
        select *
        from CashStream where 1=1
        <if test="lenderAccountId != null">
           and lenderAccountId=#{lenderAccountId}
        </if>
        <if test="borrowerAccountId != null">
           and borrowerAccountId=#{borrowerAccountId}
        </if>
        <if test="action != -1">
           and action=#{action}
        </if>
        <if test="state != -1">
           and state=#{state}
        </if> 
        order by createtime desc 
        LIMIT #{offset}, #{recnum}
    </select>
    <select id="countByActionAndState" resultType="int">
        select count(*)
        from CashStream where 1=1
        <if test="lenderAccountId != null">
           and lenderAccountId=#{lenderAccountId}
        </if>
        <if test="borrowerAccountId != null">
           and borrowerAccountId=#{borrowerAccountId}
        </if>
        <if test="action != -1">
           and action=#{action}
        </if>
        <if test="state != -1">
           and state=#{state}
        </if> 
    </select>
	<insert id="create" parameterType="gpps.model.CashStream"
		useGeneratedKeys="true" keyProperty="id">
		insert into
		CashStream(action,createtime,lenderAccountId,borrowerAccountId,submitId,chiefamount,interest,description,paybackId,state)
		values(#{action},#{createtime},#{lenderAccountId},#{borrowerAccountId},#{submitId},#{chiefamount},#{interest},#{description},#{paybackId},#{state})
	</insert>
	<update id="changeCashStreamState">
		update CashStream set
		state=#{state} 
		where id=#{cashStreamId}
	</update>
	<delete id="delete">
		delete from CashStream
		where id=#{id}
	</delete>
	<delete id="deleteByLenderAccountId">
        delete from CashStream
        where lenderAccountId=#{accountId}
    </delete>
    <delete id="deleteByBorrowerAccountId">
        delete from CashStream
        where borrowerAccountId=#{accountId}
    </delete>
</mapper>